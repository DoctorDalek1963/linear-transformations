% lintrans - The linear transformation visualizer
% Copyright (C) 2021-2022 D. Dyson (DoctorDalek1963)

% This program is licensed under GNU GPLv3, available here:
% <https://www.gnu.org/licenses/gpl-3.0.html>

\documentclass[a4paper]{article}
\usepackage[UKenglish]{babel}  % UK writing style
\usepackage[a4paper, total={155mm, 245mm}]{geometry}  % Good margins

\usepackage{minted}  % Code highlighting for appendices
\setminted[python]{
	linenos,
	breaklines,
	breakafter=(\{[\,,
	breakbefore=)\}]\#,
	fontsize=\footnotesize,
	tabsize=4,
	python3
}

\setmintedinline[python]{
	fontsize=\normalsize
}

% Make the line numbers in minted code snippets look better
\renewcommand{\theFancyVerbLine}{
	\ttfamily
	\textcolor[rgb]{0.5,0.5,1}{
		\footnotesize
		\oldstylenums{
			\arabic{FancyVerbLine}
		}
	}
}

% Code for line breaks taken from https://tex.stackexchange.com/questions/219445/line-break-in-texttt#219497
\renewcommand{\texttt}[1]{%
	\begingroup
	\ttfamily
	\begingroup\lccode`~=`/\lowercase{\endgroup\def~}{/\discretionary{}{}{}}%
	\begingroup\lccode`~=`.\lowercase{\endgroup\def~}{.\discretionary{}{}{}}%
	\catcode`/=\active\catcode`.=\active
	\scantokens{#1\noexpand}%
	\endgroup
}

\usepackage{csquotes}  % Context-sensitive quotes
\usepackage{gensymb} % General symbols
\usepackage{amsmath, amssymb, mathtools}  % Mathematical stuff

\usepackage{tikz}
\usetikzlibrary{trees}
\usetikzlibrary{shapes.misc}

\usepackage{graphicx}
\graphicspath{{./images}}

\newcommand{\setspacing}{\setlength{\parindent}{0em}\setlength{\parskip}{1em}}

\usepackage{luacode}

\begin{luacode}
function myreplace(s,a,b)
	x = string.gsub(s,a,b)
	tex.sprint(x)
end
\end{luacode}

\newcommand\replace[3]{\directlua{
	myreplace(\luastring{#1}, \luastring{#2}, \luastring{#3})
}}

% Figure side-by-side left and right commands
\newcommand{\fsbsl}[3]{
\begin{figure}[H]
	\begin{minipage}{0.45\linewidth}
		\centering
		\includegraphics[width=\linewidth]{#1}
		\caption{#2}
		\label{fig:\replace{#1}{/}{:}}
	\end{minipage}\hfill
	\begin{minipage}{0.5\linewidth}\setspacing
#3
	\end{minipage}
	\vspace{-1em}
\end{figure}
}

\newcommand{\fsbsr}[3]{
\begin{figure}[H]
	\begin{minipage}{0.5\linewidth}\setspacing
#3
	\end{minipage}\hfill
	\begin{minipage}{0.45\linewidth}
		\centering
		\includegraphics[width=\linewidth]{#1}
		\caption{#2}
		\label{fig:\replace{#1}{/}{:}}
	\end{minipage}
	\vspace{-1em}
\end{figure}
}

\usepackage[bottom]{footmisc}  % Force footnotes to bottom of page

\usepackage{fontspec}
\setmonofont[Scale=MatchLowercase]{Hack}

% This allows for a nice, automatic bibliography
\usepackage[backend=biber, sorting=none, style=numeric]{biblatex}
\addbibresource{references.bib}

\usepackage[hidelinks]{hyperref}  % Easy cross-referencing, but without ugly highlighting

\hypersetup{
	pdftitle=lintrans,
	pdfauthor=D. Dyson
}

\usepackage{fancyhdr}  % Set up nice headers and footers

\pagestyle{fancy}
\fancyhf{}

% Define header
\lhead{Candidate name: D. Dyson}
\chead{Candidate number: 123456}
\rhead{Centre number: 123456}

% This is used to allow for separate files for each section
% It should be the last thing imported in the preamble
\usepackage{subfiles}

\begin{document}

% START title page

\begin{center}
	\vspace*{6.5cm}

	\Huge{\texttt{lintrans}}

	\vspace{0.8cm}

	\Large{by D. Dyson}

	\vfill
\end{center}

{\large
\begin{tabular}{ll}
Centre Name:& The Duston School\\
Centre Number:& 123456\\
Candidate Number:& 123456
\end{tabular}
}

\normalsize

\thispagestyle{empty}
\newpage

% END title page

% START contents page

\thispagestyle{fancy}
\pagenumbering{roman}
\cfoot{\thepage}

\tableofcontents
\newpage

% END contents page

% START main document

% No indents, but nice spacing between paragraphs
% This is just a personal style preference
\setspacing

\pagenumbering{arabic}

% Define nice page numbers
\cfoot{Page \thepage\ of \pageref*{last_document_page}}

\section{Analysis\label{analysis}}
\subfile{sections/analysis.tex}

\newpage

\section{Design\label{design}}
\subfile{sections/design.tex}

\newpage

\section{Development\label{development}}
\subfile{sections/processed_development.tex}

% END main document

% START bibliography

\newpage

% Manually add the bibliography (unnumbered) to the contents
\addcontentsline{toc}{section}{References}

\printbibliography

\label{last_document_page}

% END bibliography

% START appendix

\clearpage

\appendix

\cfoot{\thepage}

\section{Project code\label{appendix:project-code}}
\subfile{sections/appendices/project_code.tex}

\newpage

\section{Testing code\label{appendix:testing-code}}
\subfile{sections/appendices/testing_code.tex}

% END appendix

\end{document}
