% lintrans - The linear transformation visualizer
% Copyright (C) 2021-2022 D. Dyson (DoctorDalek1963)

% This program is licensed under GNU GPLv3, available here:
% <https://www.gnu.org/licenses/gpl-3.0.html>

\documentclass[a4paper]{article}
\usepackage[UKenglish]{babel}  % UK writing style
\usepackage[a4paper, total={155mm, 245mm}]{geometry}  % Good margins

\usepackage{minted}  % Code highlighting for snippets and appendices
\setminted{
	linenos,
	breaklines,
	breakafter=(\{[\,,
	breakbefore=)\}]\#_,
	fontsize=\footnotesize,
	tabsize=4,
}

\setmintedinline{
	fontsize=\normalsize,
}

\newmintinline[pyinline]{python}{
	fontsize=\normalcolor,
	python3
}

\makeatletter
% Remove red box from minted environments when parser fails
\AtBeginEnvironment{minted}{\dontdofcolorbox}
\def\dontdofcolorbox{\renewcommand\fcolorbox[4][]{##4}}

% Make paragraph headings look like subsubsubsections
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
						{-3.25ex\@plus -1ex \@minus -.2ex}%
						{1.5ex \@plus .2ex}%
						{\normalfont\normalsize\bfseries}}
\makeatother

% Count paragraphs in the toc
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

% Make the line numbers in minted code snippets look better
\renewcommand{\theFancyVerbLine}{
	\ttfamily
	\textcolor[rgb]{0.5,0.5,1}{
		\footnotesize
		\oldstylenums{
			\arabic{FancyVerbLine}
		}
	}
}

% Code for line breaks taken from https://tex.stackexchange.com/questions/219445/line-break-in-texttt#219497
\renewcommand{\texttt}[1]{%
	\begingroup
	\ttfamily
	\begingroup\lccode`~=`/\lowercase{\endgroup\def~}{/\discretionary{}{}{}}%
	\begingroup\lccode`~=`.\lowercase{\endgroup\def~}{.\discretionary{}{}{}}%
	\catcode`/=\active\catcode`.=\active
	\scantokens{#1\noexpand}%
	\endgroup
}

\usepackage{csquotes}  % Context-sensitive quotes
\usepackage{gensymb} % General symbols
\usepackage{amsmath, amssymb, mathtools, cancel}  % Mathematical stuff

\usepackage{pdflscape, longtable, array} % Multi-page landscape tables

% Count test numbers in the post-development testing table
\newcounter{pdtestcounter}
\newcommand{\testnum}[1]{%
	\refstepcounter{pdtestcounter}T\thepdtestcounter\label{pdtest:#1}
}

% Number figures and equations based on subsections
\usepackage{etoolbox}
\numberwithin{figure}{subsection}
\numberwithin{equation}{subsection}
\AtBeginEnvironment{figure}{\stepcounter{equation}}
\AtBeginEnvironment{equation}{\stepcounter{figure}}

\usepackage{tikz}
\usetikzlibrary{shapes.misc, trees}
\usepackage{tkz-euclide}

\usetikzlibrary{external}
\tikzexternalize
\tikzsetexternalprefix{tikz-imgs/}

\usepackage{graphicx}
\graphicspath{{./images}}

\newcommand{\setspacing}{\setlength{\parindent}{0em}\setlength{\parskip}{1em}}

\usepackage{luacode}

\newcommand\replace[3]{\directlua{
	local s, _ = string.gsub(\luastring{#1}, \luastring{#2}, \luastring{#3})
	tex.sprint(s)
}}

% Figure side-by-side left and right commands
\newcommand{\fsbsl}[4][0.45]{
\begin{figure}[H]
	\begin{minipage}{#1\linewidth}
		\centering
		\includegraphics[width=\linewidth]{#2}
		\caption{#3}
		\label{fig:\replace{#2}{/}{:}}
	\end{minipage}\hfill
	\begin{minipage}{0.95\linewidth - #1\linewidth}\setspacing
#4
	\end{minipage}
	\vspace{-1em}
\end{figure}
}

\newcommand{\fsbsr}[4][0.45]{
\begin{figure}[H]
	\begin{minipage}{0.95\linewidth - #1\linewidth}\setspacing
#4
	\end{minipage}\hfill
	\begin{minipage}{#1\linewidth}
		\centering
		\includegraphics[width=\linewidth]{#2}
		\caption{#3}
		\label{fig:\replace{#2}{/}{:}}
	\end{minipage}
	\vspace{-1em}
\end{figure}
}

% Simple figure with image and caption, with optional width
\newcommand{\simplefig}[3][0.95]{%
\begin{figure}[H]
	\centering
	\includegraphics[width=#1\linewidth]{#2}
	\caption{#3}
	\label{fig:\replace{#2}{/}{:}}
\end{figure}
}

\newcommand{\pytestScreenshot}[2][Running \texttt{pytest} with the new tests]{%
\begin{figure}[H]
	\centering
	\includegraphics[width=0.98\linewidth]{development/#2/pytest.png}
	\caption{#1}
	\label{fig:development:#2:pytest.png}
\end{figure}
}

\usepackage[bottom]{footmisc}  % Force footnotes to bottom of page

\usepackage[quiet]{fontspec}
\setmonofont[Scale=MatchLowercase]{Hack}

% This allows for a nice, automatic bibliography
\usepackage[backend=biber, sorting=nty, style=numeric]{biblatex}
\addbibresource{bibs/analysis.bib}
\addbibresource{bibs/docs.bib}
\addbibresource{bibs/misc.bib}
\addbibresource{bibs/mystuff.bib}

\setcounter{biburlnumpenalty}{7000}
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}

\usepackage[hidelinks]{hyperref}  % Easy cross-referencing, but without ugly highlighting

\hypersetup{
	pdftitle=lintrans,
	pdfauthor=Dyson Dyson
}

\usepackage{fancyhdr}  % Set up nice headers and footers

\pagestyle{fancy}
\fancyhf{}

% Define header
\lhead{Candidate name: Dyson Dyson}
\chead{Candidate number: 123456}
\rhead{Centre number: 123456}

% This is used to allow for separate files for each section
% It should be the last thing imported in the preamble
\usepackage{subfiles}

\begin{document}

% START title page

\begin{center}
	\vspace*{6.5cm}

	\Huge{\texttt{lintrans}}

	\vspace{0.8cm}

	\Large{by Dyson Dyson}

	\vfill
\end{center}

{\large
\begin{tabular}{ll}
	Centre Name:& The Duston School\\
	Centre Number:& 123456\\
	Candidate Number:& 123456
\end{tabular}
}

\normalsize
% BUILT FROM

\thispagestyle{empty}
\newpage

% END title page

% START contents page

\thispagestyle{fancy}
\pagenumbering{roman}
\cfoot{\thepage}

\tableofcontents
\newpage

% END contents page

% START main document

% No indents, but nice spacing between paragraphs
% This is just a personal style preference
\setspacing

\pagenumbering{arabic}

% Define nice page numbers
\cfoot{Page \thepage\ of \pageref*{last_document_page}}

\section{Analysis\label{analysis}}
\subfile{sections/analysis.tex}

\newpage

\section{Design\label{design}}
\subfile{sections/design.tex}

\newpage

\section{Development\label{development}}
\subfile{sections/processed_development.tex}

\newpage

% Section title included in subfile because it needs to be landscape
\subfile{sections/post_development_testing.tex}

\newpage

\section{Evaluation\label{evaluation}}
\subfile{sections/processed_evaluation.tex}

% END main document

% START bibliography

\newpage

% Manually add the bibliography (unnumbered) to the contents
\addcontentsline{toc}{section}{References}

\printbibliography

\label{last_document_page}

% END bibliography

% START appendix

\clearpage

\appendix

\cfoot{\thepage}

\section{Project code\label{appendix:project-code}}
\subfile{sections/appendices/project_code.tex}

\newpage

\section{Testing code\label{appendix:testing-code}}
\subfile{sections/appendices/testing_code.tex}

% END appendix

\end{document}
