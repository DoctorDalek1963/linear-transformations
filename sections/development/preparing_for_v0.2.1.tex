% lintrans - The linear transformation visualizer
% Copyright (C) 2021-2022 D. Dyson (DoctorDalek1963)

% This program is licensed under GNU GPLv3, available here:
% <https://www.gnu.org/licenses/gpl-3.0.html>

\documentclass[../development.tex]{subfiles}

\begin{document}

\subsubsection{Fixing slots and signals\label{development:preparing-for-v0.2.1:fixing-slots-and-signals}}

I was perusing the Qt5 documentation when I learned about the difference between the \pyinline{dialog.finished} signal and the \pyinline{dialog.accepted} signal. I decided to rework some old code to make better use these signals.

When defining a new matrix or dialog settings, we only want to save the new data if the user actually accepted the dialog by clicking the confirm button. We don't want to save it if they clicked cancel. However, in the case of the error message dialog, we always want to update the render buttons when it's closed, no matter how the user closed the dialog.

%: 66242465222a153a5f37c4a1a3c2bd50bfd90933
%: src/lintrans/gui/main_window.py:35,447-448,461-469,478-483,493,511-512 noscopes

I also added the \pyinline{@pyqtSlot()} decorator to all the relevant methods in the matrix definition dialogs. The types in the brackets indicate the signature of the method.

A slot in Qt5 is just a method that is expected to be connected to a signal, so it gets called from the event loop. Using the decorator makes it clear that a method is a slot, and also allows slightly better performance.

%: 9beff9cf25d3af655e134205572a5668279f42cc
%: src/lintrans/gui/dialogs/define_new_matrix.py:67,138-140,143-144,155-157,164,194-195,203-204,214-215,226,276-277,288-289,305-306,317,348-349,356-357,364-365 noscopes

\subsubsection{Linking in documentation\label{development:preparing-for-v0.2.1:linking-in-documentation}}

I've been using Sphinx\cite{sphinx} for my documentation this whole time, and I've been using the Sphinx extension \texttt{intersphinx} to link to the Python standard library documentation. It uses a system of binary inventory files which define a reference map between names to use in the documentation, and where to link those names to. I recently learned of the \texttt{sphobjinv} Python package, which allows you to easily create your own local inventory files to reference some external source of documentation, such as the Qt5 documentation. I read through the \texttt{sphobjinv} documentation\cite{sphobjinv-2.2-docs} and designed a small script to read a custom text file, and create the binary inventory file needed by Sphinx.

%: 5455265a51666e29ab976152c1a758a422e1004a
%: docs/create_objects_inv.py:9-64

Line 11 should say \enquote{must have .html suffices}.

%: aab8e88b0e2cdae8038c9935031c74bcdae0ad5c
%: docs/pyqt5-objects.txt language="lexers.py:SphObjInvTextLexer -x"

I then just had to change all the references to Qt5 things in the documentation and then Sphinx would automatically link all the Qt5 references to their appropriate links, as defined in this file.

\subsubsection{Improving tests\label{development:preparing-for-v0.2.1:improving-tests}}

I made some small improvements to the unit tests by making sure they handled greedy index parsing, which means that something like \texttt{A\textasciicircum2 3B} will get parsed as \texttt{A\textasciicircum\{23\}B} because whitespace is ignored, as well asserting that all invalid expressions raise \pyinline{MatrixParseError}. I also added the copyright comment to the test files.

This was a tiny change, but worth noting.

%: c07d97024e1fe00ab110f43e5c7e6737c955d680
%: tests/matrices/test_parse_and_validate_expression.py:41,50-51,55,72-73,75,78-83

%: 70e1a7271a61f3009cc4d342f46743b248498a1c
%: tests/matrices/test_parse_and_validate_expression.py:26-31,86-90

\end{document}
